<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block Breaker</title>
</head>
<body style="margin: 0; overflow: hidden; background: #1a1a1a; display: flex; justify-content: center; align-items: center; flex-direction: column; font-family: Arial, sans-serif;">
    <canvas id="gameCanvas" width="400" height="600" style="background: #111; border: 2px solid #fff;"></canvas>
    <div style="color: #fff; text-align: center; margin-top: 10px;">
        <p id="score">Điểm: 0</p>
        <p id="lives">Mạng: 3</p>
        <p id="highScore">Điểm cao: 0</p>
        <button id="pauseBtn" style="padding: 10px 20px; font-size: 16px; cursor: pointer; background: #333; color: #fff; border: 1px solid #fff;">Tạm dừng</button>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let paddle = { x: 160, width: 80, height: 10, y: 560 };
        let ball = { x: 200, y: 540, dx: 2, dy: -2, radius: 5 };
        let bricks = [];
        let items = [];
        let score = 0;
        let lives = 3;
        let highScore = localStorage.getItem('highScore') ? parseInt(localStorage.getItem('highScore')) : 0;
        let isPaused = false;
        const brickWidth = 50;
        const brickHeight = 20;
        const brickRows = 5;
        const brickCols = 8;

        // Khởi tạo gạch
        for (let i = 0; i < brickRows; i++) {
            bricks[i] = [];
            for (let j = 0; j < brickCols; j++) {
                bricks[i][j] = { x: j * (brickWidth + 5) + 5, y: i * (brickHeight + 5) + 50, hits: Math.floor(Math.random() * 3) + 1 };
            }
        }

        // Vẽ cảnh
        function drawScene() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Vẽ thanh chắn
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);
            // Vẽ bóng
            ctx.fillStyle = '#ffff00';
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fill();
            // Vẽ gạch
            bricks.forEach(row => {
                row.forEach(brick => {
                    if (brick.hits > 0) {
                        ctx.fillStyle = brick.hits === 1 ? '#00ff00' : brick.hits === 2 ? '#ffa500' : '#ff0000';
                        ctx.fillRect(brick.x, brick.y, brickWidth, brickHeight);
                    }
                });
            });
            // Vẽ vật phẩm
            items.forEach(item => {
                ctx.fillStyle = item.type === 'paddle' ? '#00b7eb' : '#ffd700';
                ctx.fillRect(item.x, item.y, 20, 10);
            });
        }

        // Cập nhật giao diện
        function updateUI() {
            document.getElementById('score').textContent = `Điểm: ${score}`;
            document.getElementById('lives').textContent = `Mạng: ${lives}`;
            document.getElementById('highScore').textContent = `Điểm cao: ${highScore}`;
        }

        // Điều khiển cảm ứng
        canvas.addEventListener('touchstart', (e) => {
            if (isPaused) return;
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            paddle.x = touch.clientX - rect.left - paddle.width / 2;
            paddle.x = Math.max(0, Math.min(canvas.width - paddle.width, paddle.x));
        });
        canvas.addEventListener('touchmove', (e) => {
            if (isPaused) return;
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            paddle.x = touch.clientX - rect.left - paddle.width / 2;
            paddle.x = Math.max(0, Math.min(canvas.width - paddle.width, paddle.x));
        });

        // Tạm dừng/tiếp tục
        document.getElementById('pauseBtn').addEventListener('click', () => {
            isPaused = !isPaused;
            document.getElementById('pauseBtn').textContent = isPaused ? 'Tiếp tục' : 'Tạm dừng';
        });

        // Cập nhật trạng thái trò chơi
        function updateGame() {
            if (isPaused) return;

            // Di chuyển bóng
            ball.x += ball.dx;
            ball.y += ball.dy;

            // Va chạm với tường
            if (ball.x + ball.radius > canvas.width || ball.x - ball.radius < 0) ball.dx = -ball.dx;
            if (ball.y - ball.radius < 0) ball.dy = -ball.dy;
            if (ball.y + ball.radius > canvas.height) {
                lives--;
                if (lives <= 0) {
                    if (score > highScore) {
                        highScore = score;
                        localStorage.setItem('highScore', highScore);
                    }
                    lives = 3;
                    score = 0;
                    ball = { x: 200, y: 540, dx: 2, dy: -2, radius: 5 };
                    paddle = { x: 160, width: 80, height: 10, y: 560 };
                    bricks = [];
                    for (let i = 0; i < brickRows; i++) {
                        bricks[i] = [];
                        for (let j = 0; j < brickCols; j++) {
                            bricks[i][j] = { x: j * (brickWidth + 5) + 5, y: i * (brickHeight + 5) + 50, hits: Math.floor(Math.random() * 3) + 1 };
                        }
                    }
                    items = [];
                } else {
                    ball = { x: 200, y: 540, dx: 2, dy: -2, radius: 5 };
                }
            }

            // Va chạm với thanh chắn
            if (ball.y + ball.radius > paddle.y && ball.y - ball.radius < paddle.y + paddle.height && ball.x > paddle.x && ball.x < paddle.x + paddle.width) {
                ball.dy = -ball.dy;
                ball.dx += (ball.x - (paddle.x + paddle.width / 2)) * 0.1;
            }

            // Va chạm với gạch
            bricks.forEach((row, i) => {
                row.forEach((brick, j) => {
                    if (brick.hits > 0 && ball.x > brick.x && ball.x < brick.x + brickWidth && ball.y > brick.y && ball.y < brick.y + brickHeight) {
                        brick.hits--;
                        score += brick.hits === 0 ? 10 : 5;
                        ball.dy = -ball.dy;
                        if (brick.hits === 0 && Math.random() < 0.2) {
                            let type = Math.random() < 0.5 ? 'paddle' : 'speed';
                            items.push({ x: brick.x + brickWidth / 2, y: brick.y, type });
                        }
                    }
                });
            });

            // Cập nhật vật phẩm
            items.forEach((item, index) => {
                item.y += 2;
                if (item.y > canvas.height) items.splice(index, 1);
                if (item.y + 10 > paddle.y && item.y < paddle.y + paddle.height && item.x > paddle.x && item.x < paddle.x + paddle.width) {
                    if (item.type === 'paddle') paddle.width = Math.min(120, paddle.width + 20);
                    else if (item.type === 'speed') {
                        ball.dx *= 1.2;
                        ball.dy *= 1.2;
                    }
                    items.splice(index, 1);
                }
            });

            drawScene();
            updateUI();
        }

        // Vòng lặp trò chơi
        setInterval(updateGame, 1000 / 60);
        drawScene();
        updateUI();
    </script>
</body>
</html>